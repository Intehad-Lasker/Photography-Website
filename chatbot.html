<script>
  const messagesDiv = document.getElementById("messages");
  const input = document.getElementById("user-input");
  const sendBtn = document.getElementById("send-btn");

  function appendMessage(sender, text) {
    const div = document.createElement("div");
    div.classList.add("msg", sender);
    div.innerHTML = text; // ✅ allow HTML
    messagesDiv.appendChild(div);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
  }

  async function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    appendMessage("user", text);
    input.value = "";

    try {
      const response = await fetch("/.netlify/functions/chatbot", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text })
      });

      if (!response.ok) {
        const errorText = await response.text();
        appendMessage("bot", `⚠️ Server error: ${errorText}`);
        return;
      }

      const data = await response.json();
      if (data.reply) {
        appendMessage("bot", data.reply);
      } else {
        appendMessage("bot", "⚠️ No reply received from server.");
      }
    } catch (error) {
      console.error("Frontend error:", error);
      appendMessage("bot", "⚠️ Sorry, something went wrong.");
    }
  }

  sendBtn.addEventListener("click", sendMessage);
  input.addEventListener("keypress", (e) => {
    if (e.key === "Enter") sendMessage();
  });
</script>
